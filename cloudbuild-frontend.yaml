steps:
  # Build the frontend Docker image with build-time env var 
  # Using the $_API_URL substitution variable for the backend URL
  - name: 'gcr.io/cloud-builders/docker' 
    args: 
      [
        'build', 
        '--build-arg', 
        'VITE_API_URL=$_API_URL', # Passed as substitution variable when running trigger
        '-t', 
        'gcr.io/$PROJECT_ID/recipe-frontend', 
        './frontend'
      ] 
  
  # Push the image to Container Registry 
  - name: 'gcr.io/cloud-builders/docker' 
    args: 
      [
        'push', 
        'gcr.io/$PROJECT_ID/recipe-frontend'
      ] 
  
  # Deploy to Cloud Run
  - name: 'gcr.io/cloud-builders/gcloud' 
    args: 
      [ 
        'run', 
        'deploy', 
        'recipe-frontend', 
        '--image', 
        'gcr.io/$PROJECT_ID/recipe-frontend', 
        '--platform', 
        'managed', 
        '--region', 
        'us-central1', 
        '--allow-unauthenticated', 
        '--port', 
        '80' 
      ] 

# Add logging configuration 
options: 
  logging: CLOUD_LOGGING_ONLY

# Define the substitution variable (required for running the trigger)
substitutions:
  _API_URL: 'PLACEHOLDER_BACKEND_URL'
